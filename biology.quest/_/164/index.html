<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>NebulaPlay</title>
<!-- Montserrat -->
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@800&amp;display=swap" rel="stylesheet"/>
<style>
  /* Top bar */
  nav img {
    width: 95px;
    height: auto;
    margin-right: 1%;
    border-radius: 1vw;
  }
  nav h3 {
    font-size: 4vw;
    font-weight: 800;
    color: white;
    font-family: 'Montserrat', sans-serif;
  }

  /* Game container under the nav */
  .game-wrap {
    position: relative;        /* ensure proper stacking above background */
    z-index: 2;                /* sits above any accidental layers */
    flex: 1 1 auto;
    display: flex;
    align-items: center;
    justify-content: center;
    min-width: 0;
  }
  .game-wrap iframe {
    width: 100%;
    height: 100%;
    border: none;
    border-radius: 8px;
    background: #000;
  }

  /* Floating right ad */
  .side-ad {
    position: fixed;
    top: 0px;
    right: 0;
    width: 300px;
    height: 600px;
    z-index: 9999;
    display: flex;
    justify-content: center;
    align-items: center;
    border-radius: 8px;
    overflow: hidden;
    backdrop-filter: blur(6px) saturate(140%) brightness(85%);
  }

  .content {
    position: fixed;
    top: 7vw;
    left: 0;
    right: 0;
    bottom: 0;
    display: flex;
    align-items: stretch;
    justify-content: center;
    padding: 0 16px 16px 16px;
    box-sizing: border-box;
    margin-right: 300px; /* reserve space for ad (auto-adjusted in script) */
  }

  nav {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 7vw;
    display: flex;
    align-items: center;
    backdrop-filter: blur(10px) saturate(200%) brightness(70%);
    padding: 0 1%;
    z-index: 10;
  }

  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    overflow: hidden;
    background: black url(/images/colour-dark-grey-mz-vf.jpg) center center / cover no-repeat fixed;
  }
</style>

<!-- Google Publisher Tag (GAM) -->
<script async crossorigin="anonymous" src="https://securepubads.g.doubleclick.net/tag/js/gpt.js"></script>
<script>
  window.googletag = window.googletag || {cmd: []};
  googletag.cmd.push(function() {
    const railSlot = googletag.defineSlot('/23289777950/300x600', [300, 600], 'div-gpt-ad-1757794050642-0')
      .addService(googletag.pubads());
    googletag.pubads().enableSingleRequest();
    googletag.enableServices();

    let refreshes = 0;
    const MAX_REFRESHES = 6;
    const INTERVAL_MS  = 30000;
    let inView = false;

    if ('IntersectionObserver' in window) {
      const io = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          inView = entry.isIntersecting && entry.intersectionRatio >= 0.5;
        });
      }, { threshold: [0.5] });
      const el = document.getElementById('div-gpt-ad-1757794050642-0');
      if (el) io.observe(el);
    } else {
      inView = true;
    }

    setInterval(function () {
      if (!inView) return;
      if (refreshes >= MAX_REFRESHES) return;
      googletag.pubads().refresh([railSlot], { changeCorrelator: false });
      refreshes++;
    }, INTERVAL_MS);
  });
</script>
</head>
<body>
  <nav>
    <a class="logo-link" data-href="/biology.quest/" style="cursor:pointer;">
      <img alt="logo" src="/images/logo.png"/>
    </a>
    <script>
      document.querySelectorAll('.logo-link').forEach(link => {
        link.addEventListener('click', e => {
          e.preventDefault(); // stops new tab or default <a> behavior
          window.location.href = link.dataset.href; // always same tab
        });
      });
    </script>
    <h3>www.Biology.Quest</h3>
  </nav>

  <div class="content">
    <!-- Game -->
    <div class="game-wrap">
      <iframe
        id="gameframe"
        src="https://lolbeans.io/"
        tabindex="0"
        sandbox="allow-scripts allow-same-origin allow-pointer-lock allow-forms allow-popups allow-modals"
        allow="fullscreen; autoplay; clipboard-read; clipboard-write; gamepad; xr-spatial-tracking; picture-in-picture"
      >
        <p>Your browser does not support iframes.</p>
      </iframe>
    </div>
    <!-- Right Vertical Ad -->
  </div>

  <script>
    // Disable right-click
    document.addEventListener("contextmenu", function(e) {
      e.preventDefault();
    });
  </script>

  <aside class="side-ad">
    <!-- /23289777950/300x600 -->
    <div id="div-gpt-ad-1757794050642-0" style="width:300px;height:600px;"></div>
    <script>
      googletag = window.googletag || {cmd: []};
      googletag.cmd.push(function() {
        googletag.display('div-gpt-ad-1757794050642-0');
      });
    </script>
  </aside>

  <!-- Focus + layout guard -->
  <script>
    (function () {
      const frame = document.getElementById('gameframe');
      const content = document.querySelector('.content');
      const sideAd = document.querySelector('.side-ad');
      const AD_WIDTH = 300;              // matches .side-ad width
      const MIN_PLAYABLE_WIDTH = 640;    // adjust if your game needs more/less

      function resizeGuard() {
        const available = window.innerWidth - AD_WIDTH;
        if (available < MIN_PLAYABLE_WIDTH) {
          // Stack layout so the ad won't overlay or steal interactions
          content.style.marginRight = '0';
          sideAd.style.position = 'static';
        } else {
          content.style.marginRight = AD_WIDTH + 'px';
          sideAd.style.position = 'fixed';
          sideAd.style.right = '0';
          sideAd.style.top = '0px';
        }
      }

      function focusFrame() {
        try {
          frame.focus();
          // Some browsers transfer focus on a tick
          setTimeout(() => frame.focus(), 0);
        } catch (_) {}
      }

      // Try to focus as soon as the iframe is ready
      frame.addEventListener('load', focusFrame);

      // Also focus on user interactions with the game area
      ['click', 'mousedown', 'mouseenter', 'touchstart'].forEach(evt => {
        frame.addEventListener(evt, focusFrame, { passive: true });
      });
      document.querySelector('.game-wrap').addEventListener('click', focusFrame);

      window.addEventListener('resize', resizeGuard);
      resizeGuard();
    })();
  </script>
</body>
</html>
